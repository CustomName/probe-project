<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ProbeProject</title>
    <script src="https://unpkg.com/vue@2"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
</head>

<body style="margin:4vmin;">
<h1>Банк ДАВАЙ-ДАВАЙ</h1>
<h2>Работа со счетами клиента</h2>

<div id="foundClientForm" class="card bg-light mb-3">
    <div class="card-header">
        Поиск клиента
    </div>
    <div class="card-body">
        <input v-model="clientInn" placeholder="введите инн">
        <button v-on:click="findClientByInn" class="btn btn-dark">Найти</button>
        <div>
            <span v-show="error" class="badge bg-danger">{{error}}</span>
        </div>
    </div>
    <div class="card-footer">
        <table class="table animate__animated animate__flash" v-show="showTable">
            <thead class="thead-dark">
            <tr>
                <th scope="col">ID</th>
                <th scope="col">ФИО</th>
                <th scope="col">ИНН</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>{{foundClient.idClient}}</td>
                <td>{{foundClient.fio}}</td>
                <td>{{foundClient.inn}}</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<div id="processForm" v-show="show" class="card bg-light mb-3 animate__animated animate__fadeInDown">
    <div class="card-header">
        Процессы клиента
    </div>
    <div class="card-body">
        <button v-on:click="findClientProcesses" class="btn btn-secondary">Обновить инфо</button>
        <button v-on:click="postProcess" class="btn btn-dark">Начать новый процесс</button>
        <div>
            <span v-show="error" class="badge bg-danger">{{error}}</span>
        </div>
    </div>
    <div class="card-footer">
        <table class="table animate__animated animate__flash" v-show="showTable">
            <thead class="thead-dark">
            <tr>
                <th scope="col">ID</th>
                <th scope="col">СТАТУС</th>
                <th scope="col">ДАТА НАЧАЛА</th>
                <th scope="col">ДАТА ПОСЛЕДНЕГО ОБНОВЛЕНИЯ</th>
            </tr>
            </thead>
            <tbody>
            <tr v-for="process in processesList"
                v-bind:key="process.idProcess">
                <td>{{process.idProcess}}</td>
                <td>{{process.processStatus}}</td>
                <td>{{process.startDate}}</td>
                <td>{{process.lastUpdateDate}}</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
        var foundClientForm = new Vue({
          el: '#foundClientForm',
          data: {
            showTable: false,
            clientInn: '',
            foundClient: {},
            error: ''
          },
          methods: {
            findClientByInn: function() {
              this.showTable = false;
              this.error = '';
              processForm.show = false;
              processForm.processesList = [];
              axios
                  .get('http://localhost:8080/clients/inn/' + this.clientInn)
                  .then(resp => {
                    this.foundClient = resp.data;
                    processForm.show = true;
                  })
                  .catch(err => {
                    this.foundClient = {};
                    this.error = err.response.data.message;
                  })
                  .finally(() => this.showTable = true)
            }
          }
        })

        var processForm = new Vue({
          el: '#processForm',
          data: {
            show: false,
            showTable: false,
            processesList: [],
            error: ''
          },
          methods: {
            postProcess: function() {
              this.error = '';
              this.showTable = false;
              var req = {
                idClient: foundClientForm.foundClient.idClient
              };
              axios
                  .post('http://localhost:8080/processes', req)
                  .then(resp => {
                    this.processesList = [resp.data];
                  })
                  .catch(err => {
                    this.error = err.response.data.message;
                  })
                  .finally(() => this.showTable = true)
            },
            findClientProcesses: function() {
              this.error = '';
              this.showTable = false;
              axios
                  .get('http://localhost:8080/processes/clients/' + foundClientForm.foundClient.idClient)
                  .then(resp => {
                    this.processesList = resp.data;
                  })
                  .catch(err => {
                    this.error = err.response.data.message;
                  })
                  .finally(() => this.showTable = true)
            }
          }
        })


</script>
</body>

</html>